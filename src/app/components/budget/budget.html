<div class="budget-container">
  <h3>Set Budget Limits</h3>
  <form [formGroup]="budgetForm" (ngSubmit)="onSubmit()" class="budget-form">
    <div class="form-group">
      <label for="category">Category:</label>
      <select id="category" formControlName="category" required>
        <option value="">Select a category</option>
        @for (category of categories; track category) {
          <option [value]="category">{{ category }}</option>
        }
      </select>
      @if (budgetForm.get('category')?.invalid && budgetForm.get('category')?.touched) {
        <div class="error">
          Category is required.
        </div>
      }
    </div>

    <div class="form-group">
      <label for="limit">Budget Limit ($):</label>
      <input type="number" id="limit" formControlName="limit" step="0.01" min="0.01" required>
      @if (budgetForm.get('limit')?.invalid && budgetForm.get('limit')?.touched) {
        <div class="error">
          Limit is required and must be greater than 0.
        </div>
      }
    </div>

    <button type="submit" [disabled]="budgetForm.invalid" class="submit-btn">Set Budget</button>
  </form>

  <div class="budgets-list">
    <h4>Current Budgets</h4>
    @if (budgets.length === 0) {
      <div class="no-budgets">
        No budgets set yet.
      </div>
    }
    @for (budget of budgets; track budget.category) {
      <div class="budget-item">
        <div class="budget-info">
          <strong>{{ budget.category }}</strong>: ${{ budget.limit }}
        </div>
        <div class="budget-status">
          @if (getBudgetStatus(budget.category).overBudget) {
            <div class="over-budget">
              ⚠️ Over Budget! Spent: ${{ getBudgetStatus(budget.category).spent.toFixed(2) }}
            </div>
          } @else {
            <div class="within-budget">
              ✅ Within Budget. Spent: ${{ getBudgetStatus(budget.category).spent.toFixed(2) }}
            </div>
          }
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getBudgetStatus(budget.category).percentage"></div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
